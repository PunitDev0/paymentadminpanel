import{r,j as s,m as N,n as P,o as C}from"./app-BhIvF-2x.js";import{B as f}from"./button-DqwfdkFe.js";import{S as U,a as w,b as E,c as k,d as F}from"./select-DDGTz6sR.js";import T from"./PermissionTable-DSqDd40I.js";import"./index-CrueKese.js";import"./clsx-B-dksMZM.js";import"./utils-CiMRq3MP.js";import"./index-3fh5wBpP.js";import"./index-CIbWgBxM.js";import"./check-BVEHZVcu.js";import"./table-C3YgYIgZ.js";import"./switch-BW-fEY-u.js";function G(){const[j,g]=r.useState([]),[i,m]=r.useState(null),[l,S]=r.useState(null),[u,x]=r.useState([]),[o,a]=r.useState(!0),[p,c]=r.useState(null);r.useEffect(()=>{(async()=>{try{const t=await N();g(t.users),t.users.length>0&&m(t.users[0].id),a(!1)}catch{c("Failed to fetch users"),a(!1)}})()},[]),r.useEffect(()=>{if(!i)return;(async()=>{a(!0);try{const t=await P(i);S(t.user),x(t.permissions),a(!1)}catch{c("Failed to fetch permissions"),a(!1)}})()},[i]);const b=(e,t)=>{x(n=>n.map(d=>d.service_id===e?{...d,has_access:!t}:d))},y=async()=>{a(!0);try{await C(i,u),a(!1),alert("Permissions updated successfully!")}catch{c("Failed to update permissions"),a(!1)}},v=()=>{window.location.reload()};if(o)return s.jsx("div",{className:"text-center py-10",children:"Loading..."});if(p)return s.jsx("div",{className:"text-center py-10 text-red-500",children:p});const h=u.reduce((e,t)=>{const n=t.category_name;return e[n]||(e[n]=[]),e[n].push(t),e},{});return s.jsxs("div",{className:"container mx-auto p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin: Manage User Permissions"}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User"}),s.jsxs(U,{value:i==null?void 0:i.toString(),onValueChange:e=>m(parseInt(e)),children:[s.jsx(w,{className:"w-[300px]",children:s.jsx(E,{placeholder:"Select a user"})}),s.jsx(k,{children:j.map(e=>s.jsxs(F,{value:e.id.toString(),children:[e.name," (",e.email,")"]},e.id))})]})]}),l&&s.jsxs(s.Fragment,{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Permissions for ",l.name]}),s.jsxs("p",{className:"text-gray-600 mb-6",children:["Email: ",l.email]}),Object.keys(h).map(e=>s.jsx(T,{category:e,permissions:h[e],onToggle:b},e)),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx(f,{onClick:y,disabled:o,children:"Save Changes"}),s.jsx(f,{variant:"secondary",onClick:v,disabled:o,children:"Cancel"})]})]})]})}export{G as default};
