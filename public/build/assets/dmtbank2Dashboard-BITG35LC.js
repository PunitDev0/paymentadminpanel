import{r as p,l as ae,j as e}from"./app-DO3Hs0rk.js";import{L as A,C as re,a as oe,b as ne,P as le,c as ie,p as de,d as ce,e as me}from"./index-CgRqHcCd.js";import{F as xe}from"./filter-CdPx99Av.js";import{F as he}from"./file-text-D4EVplgk.js";import{A as g,a as u}from"./arrow-up-D5nyvcDA.js";import{D as b,P as ge}from"./percent-zAdg1mku.js";re.register(oe,ne,le,ie,de,ce,me);const Ne=()=>{const[D,U]=p.useState([]),[i,W]=p.useState([]),[L,P]=p.useState("All"),[f,R]=p.useState(""),[j,T]=p.useState(""),[O,k]=p.useState(!1);p.useEffect(()=>{H()},[]);const H=async()=>{k(!0);try{const t=await ae();console.log("Fetched DMT Bank 2 Data:",t);const s=t.map(a=>({...a,created_at:new Date(a.created_at)}));U(s),S(s,L,f,j)}catch(t){console.error("Failed to fetch DMT Bank 2 data:",t)}finally{k(!1)}},S=(t,s,a,l)=>{let o=[...t];const r=new Date;if(a&&l){const h=new Date(a),m=new Date(l);m.setHours(23,59,59,999),o=o.filter(d=>{const x=new Date(d.created_at);return x>=h&&x<=m}),console.log("Date Range Filter Applied:",{startDate:h,endDate:m,filtered:o})}else if(s!=="All"){switch(s){case"Daily":o=o.filter(d=>{const x=new Date(d.created_at);return x.getDate()===r.getDate()&&x.getMonth()===r.getMonth()&&x.getFullYear()===r.getFullYear()});break;case"Weekly":const h=new Date(r);h.setDate(r.getDate()-7),o=o.filter(d=>new Date(d.created_at)>=h);break;case"Monthly":const m=new Date(r);m.setMonth(r.getMonth()-1),o=o.filter(d=>new Date(d.created_at)>=m);break}console.log(`${s} Filter Applied:`,o)}W(o)},Y=t=>{P(t),R(""),T(""),S(D,t,"","")},V=()=>{f&&j&&S(D,"",f,j)},y=i.length,C=i.reduce((t,s)=>t+parseFloat(s.amount||0),0),z=y?(C/y).toFixed(2):0,w=y>0?(i.filter(t=>t.stateresp==="SUCCESS").length/y*100).toFixed(2):0,X=i.reduce((t,s)=>t+parseFloat(s.netcommission||0),0),I=i.reduce((t,s)=>t+parseFloat(s.customercharge||0),0),Q=i.reduce((t,s)=>t+parseFloat(s.gst||0),0),Z=i.reduce((t,s)=>t+parseFloat(s.tds||0),0),B=new Date,N=new Date(B);N.setDate(B.getDate()-1);const v=D.filter(t=>{const s=new Date(t.created_at);return s.getDate()===N.getDate()&&s.getMonth()===N.getMonth()&&s.getFullYear()===N.getFullYear()}).reduce((t,s)=>t+parseFloat(s.amount||0),0),n=v?(C-v)/v*100:0,c=[...new Set(i.map(t=>new Date(t.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})))].sort((t,s)=>new Date(t.split("/").reverse().join("-"))-new Date(s.split("/").reverse().join("-"))),_=c.map(t=>i.filter(a=>new Date(a.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((a,l)=>a+parseFloat(l.amount||0),0)),$=c.map(t=>{const s=i.filter(l=>new Date(l.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((l,o)=>l+(o.stateresp==="SUCCESS"?1:0),0),a=i.filter(l=>new Date(l.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).length;return a>0?s/a*100:0}),E=c.map(t=>i.filter(a=>new Date(a.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((a,l)=>a+parseFloat(l.netcommission||0),0));console.log("Chart Data:",{dates:c,amountTrend:_,successRateTrend:$,commissionTrend:E});const q={labels:c,datasets:[{label:"Amount",data:_,borderColor:"#6366f1",backgroundColor:"#6366f1",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#6366f1",pointBorderWidth:2,tension:.4}]},J={labels:c,datasets:[{label:"Success Rate (%)",data:$,borderColor:"#10b981",backgroundColor:"#10b981",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#10b981",pointBorderWidth:2,tension:.4}]},K={labels:c,datasets:[{label:"Commission",data:E,borderColor:"#f59e0b",backgroundColor:"#f59e0b",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#f59e0b",pointBorderWidth:2,tension:.4}]},F={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:12},color:"#6b7280"}},tooltip:{enabled:!1,external:t=>{let s=document.getElementById("chartjs-tooltip");s||(s=document.createElement("div"),s.id="chartjs-tooltip",s.className="bg-white p-3 rounded-lg shadow-lg border border-gray-200",document.body.appendChild(s));const a=t.tooltip;if(a.opacity===0){s.style.opacity="0";return}if(s.style.opacity="1",s.style.position="absolute",s.style.pointerEvents="none",a.body){const o=a.title||[],r=a.body.map(m=>m.lines);let h=`<div class="text-sm text-gray-800 font-medium">${o[0]}</div>`;r.forEach((m,d)=>{const x=a.labelColors[d].borderColor,G=m[0].split(": ")[1],se=a.dataPoints[d].dataset.label.includes("Success Rate")?`${parseFloat(G).toFixed(2)}%`:`₹${parseFloat(G).toLocaleString()}`;h+=`
                <div class="text-sm text-gray-600 flex items-center">
                  <span class="w-3 h-3 rounded-full mr-2" style="background-color: ${x}"></span>
                  ${a.dataPoints[d].dataset.label}: ${se}
                </div>`}),s.innerHTML=h}const l=t.chart.canvas.getBoundingClientRect();s.style.left=l.left+window.pageXOffset+a.caretX+"px",s.style.top=l.top+window.pageYOffset+a.caretY+"px"}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12}}},y:{grid:{color:"#e5e7eb"},ticks:{color:"#6b7280",font:{size:12},callback:(t,s,a,l)=>{if(!l)return t;const o=l.chart;return o?o.data.datasets[0].label.includes("Success Rate")?`${t}%`:`₹${t.toLocaleString()}`:t}},beginAtZero:!0,max:t=>t.chart&&t.chart.data.datasets[0].label.includes("Success Rate")?100:void 0}},animation:{duration:800,easing:"easeOutQuart"}},ee=i.reduce((t,s)=>{const a=s.remitter||"Unknown";return t[a]||(t[a]={amount:0,commission:0}),t[a].amount+=parseFloat(s.amount||0),t[a].commission+=parseFloat(s.netcommission||0),t},{}),M=Object.entries(ee).map(([t,{amount:s,commission:a}])=>({name:t,amount:s,commission:a})).sort((t,s)=>s.amount-t.amount).slice(0,5),te=()=>{const t=r=>`"${String(r).replace(/"/g,'""')}"`,s=[["Remitter","Beneficiary","Amount","Commission","Customer Charge","GST","TDS","State Response","Date"],...i.map(r=>[t(r.remitter||""),t(r.benename||""),r.amount||0,r.netcommission||0,r.customercharge||0,r.gst||0,r.tds||0,t(r.stateresp||""),t(new Date(r.created_at).toLocaleDateString())])].map(r=>r.join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),l=window.URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download="dmt_bank2_transactions.csv",o.click(),window.URL.revokeObjectURL(l)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"DMT Bank 2 Dashboard"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("select",{value:L,onChange:t=>Y(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Select time filter",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",value:f,onChange:t=>R(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Start date"}),e.jsx("input",{type:"date",value:j,onChange:t=>T(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"End date"}),e.jsxs("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-indigo-300 transition-colors duration-200",onClick:V,disabled:!f||!j,"aria-label":"Apply date filter",children:[e.jsx(xe,{className:"h-4 w-4 inline mr-1"})," Apply"]}),e.jsx("button",{onClick:te,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200","aria-label":"Export data as CSV",children:"Export Data"})]})]}),O?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(he,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:y}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-green-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",C.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["vs. yesterday (₹",v.toLocaleString(),")"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg. Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",parseFloat(z).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(ge,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${parseFloat(w)<50?"text-white bg-red-500":"text-white bg-green-500"}`,children:[parseFloat(w)<50?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),w,"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[w,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Commission"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",X.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-green-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Customer Charge"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",I.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total GST"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",Q.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(b,{className:"h-5 w-5 text-red-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(g,{className:"h-3 w-3 mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total TDS"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",Z.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Amount Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:q,options:F,"aria-label":"Amount Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Success Rate by Period"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:J,options:F,"aria-label":"Success Rate by Period Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Commission Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:K,options:F,"aria-label":"Commission Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Top Remitters by Amount"}),e.jsx("a",{href:"#",className:"text-sm text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"View More"})]}),e.jsx("div",{className:"space-y-4",children:M.length>0?M.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 mr-3",children:e.jsx("span",{className:"font-medium",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comm: ₹",t.commission.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:["₹",t.amount.toLocaleString()]})]},s)):e.jsx("p",{className:"text-sm text-gray-500",children:"No remitters available."})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Recent Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-gray-600 font-medium",children:[e.jsx("th",{className:"p-3 border-b",children:"Remitter"}),e.jsx("th",{className:"p-3 border-b",children:"Beneficiary"}),e.jsx("th",{className:"p-3 border-b",children:"Amount (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Commission (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Customer Charge (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"GST (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"TDS (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"State Response"}),e.jsx("th",{className:"p-3 border-b",children:"Date"})]})}),e.jsx("tbody",{children:i.length>0?i.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b",children:t.remitter||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.benename||"N/A"}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.amount||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.netcommission||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.customercharge||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.gst||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.tds||0).toLocaleString()]}),e.jsx("td",{className:"p-3 border-b",children:t.stateresp||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:new Date(t.created_at).toLocaleDateString()})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-3 text-center text-gray-500",children:"No transactions found for this period."})})})]})})]})]})]})})};export{Ne as default};
