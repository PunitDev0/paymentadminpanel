import{r as d,F as G,j as t}from"./app-CO3wtwL6.js";import{L as j,C as H,a as J,b as K,P as Q,c as V,p as X,d as Z,e as $}from"./index-BbLQWvKK.js";H.register(J,K,Q,V,X,Z,$);const ae=()=>{const[D,S]=d.useState([]),[o,C]=d.useState([]),[f,F]=d.useState("Daily"),[h,w]=d.useState(""),[x,N]=d.useState(""),[A,y]=d.useState(!1);d.useEffect(()=>{T()},[]);const T=async()=>{y(!0);try{const e=await G();console.log(e),S(e),p(e,f,h,x)}catch(e){console.error("Failed to fetch municipality data:",e)}finally{y(!1)}},p=(e,a,n,i)=>{let s=[...e];const l=new Date;if(n&&i){const g=new Date(n),b=new Date(i);s=s.filter(r=>{const m=new Date(r.created_at);return m>=g&&m<=b})}else switch(a){case"Daily":s=s.filter(r=>{const m=new Date(r.created_at);return m.getDate()===l.getDate()&&m.getMonth()===l.getMonth()&&m.getFullYear()===l.getFullYear()});break;case"Weekly":const g=new Date(l.setDate(l.getDate()-7));s=s.filter(r=>new Date(r.created_at)>=g);break;case"Monthly":const b=new Date(l.setMonth(l.getMonth()-1));s=s.filter(r=>new Date(r.created_at)>=b);break}C(s)},L=e=>{F(e),w(""),N(""),p(D,e,"","")},_=()=>{h&&x&&p(D,"",h,x)},u=o.length,v=o.reduce((e,a)=>e+parseFloat(a.amount||0),0),R=u?(v/u).toFixed(2):0,k=u>0?(o.filter(e=>e.status==="SUCCESS").length/u*100).toFixed(2):0,E=o.reduce((e,a)=>e+parseFloat(a.comm||0),0),M=o.reduce((e,a)=>e+parseFloat(a.tds||0),0),c=[...new Set(o.map(e=>new Date(e.created_at).toLocaleDateString()))].sort(),O=c.map(e=>o.filter(a=>new Date(a.created_at).toLocaleDateString()===e).reduce((a,n)=>a+parseFloat(n.amount||0),0)),U=c.map(e=>o.filter(a=>new Date(a.created_at).toLocaleDateString()===e).reduce((a,n)=>a+(n.status==="SUCCESS"?1:0),0)),P=c.map(e=>o.filter(a=>new Date(a.created_at).toLocaleDateString()===e).reduce((a,n)=>a+parseFloat(n.comm||0),0)),W={labels:c,datasets:[{label:"Amount",data:O,borderColor:"green",fill:!1}]},Y={labels:c,datasets:[{label:"Success Rate (%)",data:U,borderColor:"green",fill:!1}]},B={labels:c,datasets:[{label:"Commission",data:P,borderColor:"orange",fill:!1}]},I=o.reduce((e,a)=>{const n=a.operatorname;return e[n]||(e[n]={amount:0,comm:0}),e[n].amount+=parseFloat(a.amount||0),e[n].comm+=parseFloat(a.comm||0),e},{}),q=Object.entries(I).map(([e,{amount:a,comm:n}])=>({name:e,amount:a,comm:n})).sort((e,a)=>a.amount-e.amount).slice(0,5),z=()=>{const e=[["Txn ID","Operator Name","CA Number","Amount","Commission","TDS","Status","Refunded","Date Added"],...o.map(s=>[s.txnid,s.operatorname,s.canumber,s.amount,s.comm,s.tds,s.status,s.refunded,new Date(s.created_at).toLocaleDateString()])].map(s=>s.join(",")).join(`
`),a=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download="municipality_transactions.csv",i.click(),window.URL.revokeObjectURL(n)};return t.jsxs("div",{className:"container mx-auto p-6 bg-gray-100 min-h-screen",children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Municipality Dashboard"}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("select",{className:"p-2 border rounded",value:f,onChange:e=>L(e.target.value),children:[t.jsx("option",{value:"Daily",children:"Daily"}),t.jsx("option",{value:"Weekly",children:"Weekly"}),t.jsx("option",{value:"Monthly",children:"Monthly"})]}),t.jsx("input",{type:"date",className:"p-2 border rounded",value:h,onChange:e=>w(e.target.value),placeholder:"dd-mm-yyyy"}),t.jsx("input",{type:"date",className:"p-2 border rounded",value:x,onChange:e=>N(e.target.value),placeholder:"dd-mm-yyyy"}),t.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:_,disabled:!h||!x,children:"Apply Date Filter"})]}),t.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:z,children:"Export Data"})]}),A?t.jsx("div",{className:"text-center",children:"Loading..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Transactions"}),t.jsx("p",{className:"text-2xl",children:u})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Amount"}),t.jsxs("p",{className:"text-2xl",children:["₹",v.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Avg. Amount"}),t.jsxs("p",{className:"text-2xl",children:["₹",R]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Success Rate"}),t.jsxs("p",{className:"text-2xl",children:[k,"%"]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Commission"}),t.jsxs("p",{className:"text-2xl",children:["₹",E.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total TDS"}),t.jsxs("p",{className:"text-2xl",children:["₹",M.toFixed(2)]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Amount Trend"}),t.jsx(j,{data:W})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Success Rate by Period"}),t.jsx(j,{data:Y})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Commission Trend"}),t.jsx(j,{data:B})]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Top Operators by Amount"}),t.jsx("ul",{children:q.map((e,a)=>t.jsxs("li",{className:"py-2 border-b",children:[e.name,": ₹",e.amount.toFixed(2)," (Comm: ₹",e.comm.toFixed(2),")"]},a))})]})]})]})};export{ae as default};
