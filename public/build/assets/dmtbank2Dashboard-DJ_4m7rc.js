import{r as m,j as e}from"./app-CVSLwbXb.js";import{k as I}from"./apis-BrEZBuSk.js";import{L as j,C as J,a as K,b as Q,P as V,c as X,p as Z,d as ee,e as te}from"./index-BIsqsAbn.js";J.register(K,Q,V,X,Z,ee,te);const oe=()=>{const[N,T]=m.useState([]),[o,A]=m.useState([]),[D,R]=m.useState("Daily"),[x,f]=m.useState(""),[p,w]=m.useState(""),[k,y]=m.useState(!1);m.useEffect(()=>{_()},[]);const _=async()=>{y(!0);try{const t=await I();console.log("Fetched DMT Bank 2 Data:",t);const s=t.map(a=>({...a,created_at:new Date(a.created_at)}));T(s),b(s,D,x,p)}catch(t){console.error("Failed to fetch DMT Bank 2 data:",t)}finally{y(!1)}},b=(t,s,a,n)=>{let r=[...t];const c=new Date;if(a&&n){const g=new Date(a),h=new Date(n);h.setHours(23,59,59,999),r=r.filter(i=>{const d=new Date(i.created_at);return d>=g&&d<=h}),console.log("Date Range Filter Applied:",{startDate:g,endDate:h,filtered:r})}else{switch(s){case"Daily":r=r.filter(i=>{const d=new Date(i.created_at);return d.getDate()===c.getDate()&&d.getMonth()===c.getMonth()&&d.getFullYear()===c.getFullYear()});break;case"Weekly":const g=new Date(c);g.setDate(c.getDate()-7),r=r.filter(i=>new Date(i.created_at)>=g);break;case"Monthly":const h=new Date(c);h.setMonth(c.getMonth()-1),r=r.filter(i=>new Date(i.created_at)>=h);break}console.log(`${s} Filter Applied:`,r)}A(r)},L=t=>{R(t),f(""),w(""),b(N,t,"","")},B=()=>{x&&p&&b(N,"",x,p)},u=o.length,v=o.reduce((t,s)=>t+parseFloat(s.amount||0),0),M=u?(v/u).toFixed(2):0,E=u>0?(o.filter(t=>t.stateresp==="SUCCESS").length/u*100).toFixed(2):0,G=o.reduce((t,s)=>t+parseFloat(s.netcommission||0),0),U=o.reduce((t,s)=>t+parseFloat(s.customercharge||0),0),O=o.reduce((t,s)=>t+parseFloat(s.gst||0),0),P=o.reduce((t,s)=>t+parseFloat(s.tds||0),0),l=[...new Set(o.map(t=>new Date(t.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})))].sort((t,s)=>new Date(t.split("/").reverse().join("-"))-new Date(s.split("/").reverse().join("-"))),F=l.map(t=>o.filter(a=>new Date(a.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((a,n)=>a+parseFloat(n.amount||0),0)),S=l.map(t=>{const s=o.filter(n=>new Date(n.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((n,r)=>n+(r.stateresp==="SUCCESS"?1:0),0),a=o.filter(n=>new Date(n.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).length;return a>0?s/a*100:0}),C=l.map(t=>o.filter(a=>new Date(a.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((a,n)=>a+parseFloat(n.netcommission||0),0));console.log("Chart Data:",{dates:l,amountTrend:F,successRateTrend:S,commissionTrend:C});const W={labels:l,datasets:[{label:"Amount",data:F,borderColor:"green",fill:!1}]},Y={labels:l,datasets:[{label:"Success Rate (%)",data:S,borderColor:"green",fill:!1}]},H={labels:l,datasets:[{label:"Commission",data:C,borderColor:"orange",fill:!1}]},$=o.reduce((t,s)=>{const a=s.remitter;return t[a]||(t[a]={amount:0,commission:0}),t[a].amount+=parseFloat(s.amount||0),t[a].commission+=parseFloat(s.netcommission||0),t},{}),q=Object.entries($).map(([t,{amount:s,commission:a}])=>({name:t,amount:s,commission:a})).sort((t,s)=>s.amount-t.amount).slice(0,5),z=()=>{const t=[["Remitter","Beneficiary","Amount","Commission","Customer Charge","GST","TDS","State Response","Date"],...o.map(r=>[r.remitter,r.benename,r.amount,r.netcommission,r.customercharge,r.gst,r.tds,r.stateresp,new Date(r.created_at).toLocaleDateString()])].map(r=>r.join(",")).join(`
`),s=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="dmt_bank2_transactions.csv",n.click(),window.URL.revokeObjectURL(a)};return e.jsxs("div",{className:"container mx-auto p-6 bg-gray-100 min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"DMT Bank 2 Dashboard"}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{className:"p-2 border rounded",value:D,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",className:"p-2 border rounded",value:x,onChange:t=>f(t.target.value),placeholder:"dd-mm-yyyy"}),e.jsx("input",{type:"date",className:"p-2 border rounded",value:p,onChange:t=>w(t.target.value),placeholder:"dd-mm-yyyy"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:B,disabled:!x||!p,children:"Apply Date Filter"})]}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:z,children:"Export Data"})]}),k?e.jsx("div",{className:"text-center",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl",children:u})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl",children:["₹",v.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Avg. Amount"}),e.jsxs("p",{className:"text-2xl",children:["₹",M]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl",children:[E,"%"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Commission"}),e.jsxs("p",{className:"text-2xl",children:["₹",G.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Customer Charge"}),e.jsxs("p",{className:"text-2xl",children:["₹",U.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total GST"}),e.jsxs("p",{className:"text-2xl",children:["₹",O.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total TDS"}),e.jsxs("p",{className:"text-2xl",children:["₹",P.toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Amount Trend"}),l.length>0?e.jsx(j,{data:W}):e.jsx("p",{children:"No data available for this period."})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Success Rate by Period"}),l.length>0?e.jsx(j,{data:Y}):e.jsx("p",{children:"No data available for this period."})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Commission Trend"}),l.length>0?e.jsx(j,{data:H}):e.jsx("p",{children:"No data available for this period."})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Top Remitters by Amount"}),e.jsx("ul",{children:q.map((t,s)=>e.jsxs("li",{className:"py-2 border-b",children:[t.name,": ₹",t.amount.toFixed(2)," (Comm: ₹",t.commission.toFixed(2),")"]},s))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Recent Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-left",children:[e.jsx("th",{className:"p-3 border",children:"Remitter"}),e.jsx("th",{className:"p-3 border",children:"Beneficiary"}),e.jsx("th",{className:"p-3 border",children:"Amount (₹)"}),e.jsx("th",{className:"p-3 border",children:"Commission (₹)"}),e.jsx("th",{className:"p-3 border",children:"Customer Charge (₹)"}),e.jsx("th",{className:"p-3 border",children:"GST (₹)"}),e.jsx("th",{className:"p-3 border",children:"TDS (₹)"}),e.jsx("th",{className:"p-3 border",children:"State Response"}),e.jsx("th",{className:"p-3 border",children:"Date"})]})}),e.jsx("tbody",{children:o.length>0?o.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border",children:t.remitter}),e.jsx("td",{className:"p-3 border",children:t.benename}),e.jsxs("td",{className:"p-3 border",children:["₹",parseFloat(t.amount).toFixed(2)]}),e.jsxs("td",{className:"p-3 border",children:["₹",parseFloat(t.netcommission).toFixed(2)]}),e.jsxs("td",{className:"p-3 border",children:["₹",parseFloat(t.customercharge).toFixed(2)]}),e.jsxs("td",{className:"p-3 border",children:["₹",parseFloat(t.gst).toFixed(2)]}),e.jsxs("td",{className:"p-3 border",children:["₹",parseFloat(t.tds).toFixed(2)]}),e.jsx("td",{className:"p-3 border",children:t.stateresp}),e.jsx("td",{className:"p-3 border",children:new Date(t.created_at).toLocaleDateString()})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-3 text-center",children:"No transactions found for this period."})})})]})})]})]})]})};export{oe as default};
