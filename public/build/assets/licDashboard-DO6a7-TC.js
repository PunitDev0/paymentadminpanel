import{r as d,j as e,v as K}from"./app-CyB6Si8G.js";import{L as v,B as W,C as Z,a as U,b as V,P as G,c as q,f as z,p as H,d as J,e as Q}from"./index-D3RcUAWz.js";import{p as b,f,s as X,a as Y}from"./parseISO-BQ0YAcZt.js";Z.register(U,V,G,q,z,H,J,Q);const st=()=>{const[m,C]=d.useState([]),[l,j]=d.useState([]),[x,S]=d.useState([]),[i,E]=d.useState("daily"),[h,L]=d.useState(""),[p,R]=d.useState(""),[P,N]=d.useState(!0),[w,D]=d.useState(null);d.useEffect(()=>{(async()=>{try{N(!0);const r=await K();console.log("Fetched LIC Data:",r),C(r),j(r),D(null)}catch(r){console.error("Failed to fetch LIC data:",r),D("Failed to load data. Please try again later.")}finally{N(!1)}})()},[]),d.useEffect(()=>{if(!m||m.length===0)return;let t=m;h&&p&&(t=m.filter(a=>{const s=new Date(a.created_at);return s>=new Date(h)&&s<=new Date(p)}));let r=[];if(i==="daily"){const a={};t.forEach(s=>{const o=b(s.created_at),n=f(o,"yyyy-MM-dd");a[n]||(a[n]={date:n,amount:0,comm:0,tds:0,status:[]}),a[n].amount+=parseFloat(s.amount||0),a[n].comm+=parseFloat(s.comm||0),a[n].tds+=parseFloat(s.tds||0),a[n].status.push(s.status)}),r=Object.entries(a).map(([s,o])=>({date:s,amount:o.amount,comm:o.comm,tds:o.tds,successRate:o.status.filter(n=>n==="1").length/o.status.length*100})).sort((s,o)=>new Date(s.date)-new Date(o.date))}else if(i==="weekly"){const a={};t.forEach(s=>{const o=b(s.created_at),n=X(o,{weekStartsOn:1}),c=f(n,"yyyy-MM-dd");a[c]||(a[c]={date:c,amount:0,comm:0,tds:0,status:[]}),a[c].amount+=parseFloat(s.amount||0),a[c].comm+=parseFloat(s.comm||0),a[c].tds+=parseFloat(s.tds||0),a[c].status.push(s.status)}),r=Object.entries(a).map(([s,o])=>({date:s,amount:o.amount,comm:o.comm,tds:o.tds,successRate:o.status.filter(n=>n==="1").length/o.status.length*100})).sort((s,o)=>new Date(s.date)-new Date(o.date))}else if(i==="monthly"){const a={};t.forEach(s=>{const o=b(s.created_at),n=Y(o),c=f(n,"yyyy-MM");a[c]||(a[c]={date:c,amount:0,comm:0,tds:0,status:[]}),a[c].amount+=parseFloat(s.amount||0),a[c].comm+=parseFloat(s.comm||0),a[c].tds+=parseFloat(s.tds||0),a[c].status.push(s.status)}),r=Object.entries(a).map(([s,o])=>({date:s,amount:o.amount,comm:o.comm,tds:o.tds,successRate:o.status.filter(n=>n==="1").length/o.status.length*100})).sort((s,o)=>new Date(s.date)-new Date(o.date))}j(t),S(r)},[m,h,p,i]);const g=l.length,F=l.reduce((t,r)=>{const a=parseFloat(r.amount);return t+(isNaN(a)?0:a)},0),k=F/g||0,T=(l.filter(t=>t.status==="1").length/g*100).toFixed(2),_=l.reduce((t,r)=>{const a=parseFloat(r.comm);return t+(isNaN(a)?0:a)},0).toFixed(2),A=l.reduce((t,r)=>{const a=parseFloat(r.tds);return t+(isNaN(a)?0:a)},0).toFixed(2),y=x.map(t=>t.date),M={labels:y,datasets:[{label:"Premium Amount",data:x.map(t=>t.amount),borderColor:"#4CAF50",fill:!1}]},O={labels:y,datasets:[{label:"Success Rate (%)",data:x.map(t=>t.successRate),backgroundColor:"#4CAF50"}]},$={labels:y,datasets:[{label:"Commission Amount",data:x.map(t=>t.comm),borderColor:"#FF9800",fill:!1}]},u={};l.forEach(t=>{if(!t.operatorname)return;u[t.operatorname]||(u[t.operatorname]={premium:0,comm:0});const r=parseFloat(t.amount),a=parseFloat(t.comm);u[t.operatorname].premium+=isNaN(r)?0:r,u[t.operatorname].comm+=isNaN(a)?0:a});const B=Object.entries(u).map(([t,{premium:r,comm:a}])=>({name:t,premium:r,comm:a})).sort((t,r)=>r.premium-t.premium),I=()=>{const t=l.map(s=>`${s.id},${s.amount},${s.comm},${s.tds},${s.created_at},${s.status},${s.operatorname}`).join(`
`),r=new Blob([`id,amount,comm,tds,created_at,status,operatorname
${t}`],{type:"text/csv"}),a=document.createElement("a");a.download="lic_data.csv",a.href=window.URL.createObjectURL(r),a.click()};return P?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."}):w?e.jsx("div",{className:"p-6 text-center text-red-500",children:w}):e.jsxs("div",{className:"p-6 max-w-full mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"LIC Dashboard"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{value:i,onChange:t=>E(t.target.value),className:"p-2 border rounded-md",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",value:h,onChange:t=>L(t.target.value),className:"p-2 border rounded-md"}),e.jsx("input",{type:"date",value:p,onChange:t=>R(t.target.value),className:"p-2 border rounded-md"}),e.jsx("button",{onClick:I,className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600",children:"Export Data"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Total Policies"}),e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:g})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Total Premium"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:["₹",F]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Avg. Policy Value"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:["₹",k.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Success Rate"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:[T,"%"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Total Commission"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:["₹",_]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md text-center",children:[e.jsx("h3",{className:"text-sm text-gray-500",children:"Total TDS"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:["₹",A]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Premium Amount Trend"}),e.jsx(v,{data:M,options:{scales:{y:{beginAtZero:!0}}}})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Success Rate by Period"}),e.jsx(W,{data:O,options:{scales:{y:{beginAtZero:!0,max:100}}}})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Commission Trend"}),e.jsx(v,{data:$,options:{scales:{y:{beginAtZero:!0}}}})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Top Insurers by Premium"}),e.jsx("ul",{children:B.map((t,r)=>e.jsxs("li",{className:"py-2 border-b last:border-b-0 text-gray-800",children:[t.name,": ₹",t.premium," (Comm: ₹",t.comm.toFixed(2),")"]},r))})]})]})};export{st as default};
