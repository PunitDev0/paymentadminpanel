import{r as g,v as te,j as e}from"./app-C8WGtTm3.js";import{P as se,L as A,C as ae,a as re,b as oe,c as ne,d as le,p as ie,e as de,f as ce}from"./index-DI1otb3d.js";import{F as me,D as v}from"./filter-CWE9fUqR.js";import{F as xe}from"./file-text-HhQ6CKnf.js";import{A as u,a as p}from"./arrow-up-DUaoXqQP.js";ae.register(re,oe,ne,le,ie,de,ce);const je=()=>{const[D,U]=g.useState([]),[l,W]=g.useState([]),[L,P]=g.useState("Daily"),[b,R]=g.useState(""),[f,T]=g.useState(""),[H,k]=g.useState(!1);g.useEffect(()=>{Y()},[]);const Y=async()=>{k(!0);try{const t=await te();console.log("Fetched Municipality Data:",t);const s=t.map(a=>({...a,created_at:new Date(a.created_at)}));U(s),S(s,L,b,f)}catch(t){console.error("Failed to fetch municipality data:",t)}finally{k(!1)}},S=(t,s,a,i)=>{let o=[...t];const r=new Date;if(a&&i){const x=new Date(a),m=new Date(i);m.setHours(23,59,59,999),o=o.filter(d=>{const h=new Date(d.created_at);return h>=x&&h<=m}),console.log("Date Range Filter Applied:",{startDate:x,endDate:m,filtered:o})}else{switch(s){case"Daily":o=o.filter(d=>{const h=new Date(d.created_at);return h.getDate()===r.getDate()&&h.getMonth()===r.getMonth()&&h.getFullYear()===r.getFullYear()});break;case"Weekly":const x=new Date(r);x.setDate(r.getDate()-7),o=o.filter(d=>new Date(d.created_at)>=x);break;case"Monthly":const m=new Date(r);m.setMonth(r.getMonth()-1),o=o.filter(d=>new Date(d.created_at)>=m);break}console.log(`${s} Filter Applied:`,o)}o.length===0&&(o=[...t]),W(o)},G=t=>{P(t),R(""),T(""),S(D,t,"","")},V=()=>{b&&f&&S(D,"",b,f)},j=l.length,C=l.reduce((t,s)=>t+parseFloat(s.amount||0),0),z=j?(C/j).toFixed(2):0,y=j>0?(l.filter(t=>t.status==="SUCCESS").length/j*100).toFixed(2):0,I=l.reduce((t,s)=>t+parseFloat(s.comm||0),0),X=l.reduce((t,s)=>t+parseFloat(s.tds||0),0),_=new Date,N=new Date(_);N.setDate(_.getDate()-1);const w=D.filter(t=>{const s=new Date(t.created_at);return s.getDate()===N.getDate()&&s.getMonth()===N.getMonth()&&s.getFullYear()===N.getFullYear()}).reduce((t,s)=>t+parseFloat(s.amount||0),0),n=w?(C-w)/w*100:0,c=[...new Set(l.map(t=>new Date(t.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})))].sort((t,s)=>new Date(t.split("/").reverse().join("-"))-new Date(s.split("/").reverse().join("-"))),B=c.map(t=>l.filter(s=>new Date(s.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((s,a)=>s+parseFloat(a.amount||0),0)),E=c.map(t=>{const s=l.filter(i=>new Date(i.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((i,o)=>i+(o.status==="SUCCESS"?1:0),0),a=l.filter(i=>new Date(i.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).length;return a>0?s/a*100:0}),M=c.map(t=>l.filter(s=>new Date(s.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((s,a)=>s+parseFloat(a.comm||0),0));console.log("Chart Data:",{dates:c,amountTrend:B,successRateTrend:E,commissionTrend:M});const Q={labels:c,datasets:[{label:"Amount",data:B,borderColor:"#6366f1",backgroundColor:"#6366f1",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#6366f1",pointBorderWidth:2,tension:.4}]},Z={labels:c,datasets:[{label:"Success Rate (%)",data:E,borderColor:"#10b981",backgroundColor:"#10b981",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#10b981",pointBorderWidth:2,tension:.4}]},q={labels:c,datasets:[{label:"Commission",data:M,borderColor:"#f59e0b",backgroundColor:"#f59e0b",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#f59e0b",pointBorderWidth:2,tension:.4}]},F={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:12},color:"#6b7280"}},tooltip:{enabled:!1,external:t=>{let s=document.getElementById("chartjs-tooltip");s||(s=document.createElement("div"),s.id="chartjs-tooltip",s.className="bg-white p-3 rounded-lg shadow-lg border border-gray-200",document.body.appendChild(s));const a=t.tooltip;if(a.opacity===0){s.style.opacity="0";return}if(s.style.opacity="1",s.style.position="absolute",s.style.pointerEvents="none",a.body){const o=a.title||[],r=a.body.map(m=>m.lines);let x=`<div class="text-sm text-gray-800 font-medium">${o[0]}</div>`;r.forEach((m,d)=>{const h=a.labelColors[d].borderColor,O=m[0].split(": ")[1],ee=a.dataPoints[d].dataset.label.includes("Success Rate")?`${parseFloat(O).toFixed(2)}%`:`₹${parseFloat(O).toLocaleString()}`;x+=`
                <div class="text-sm text-gray-600 flex items-center">
                  <span class="w-3 h-3 rounded-full mr-2" style="background-color: ${h}"></span>
                  ${a.dataPoints[d].dataset.label}: ${ee}
                </div>`}),s.innerHTML=x}const i=t.chart.canvas.getBoundingClientRect();s.style.left=i.left+window.pageXOffset+a.caretX+"px",s.style.top=i.top+window.pageYOffset+a.caretY+"px"}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12}}},y:{grid:{color:"#e5e7eb"},ticks:{color:"#6b7280",font:{size:12},callback:t=>{const s=context.chart;return s?s.data.datasets[0].label.includes("Success Rate")?`${t}%`:`₹${t.toLocaleString()}`:t}},beginAtZero:!0,max:t=>t.chart&&t.chart.data.datasets[0].label.includes("Success Rate")?100:void 0}},animation:{duration:800,easing:"easeOutQuart"}},J=l.reduce((t,s)=>{const a=s.operatorname||"Unknown";return t[a]||(t[a]={amount:0,comm:0}),t[a].amount+=parseFloat(s.amount||0),t[a].comm+=parseFloat(s.comm||0),t},{}),$=Object.entries(J).map(([t,{amount:s,comm:a}])=>({name:t,amount:s,comm:a})).sort((t,s)=>s.amount-t.amount).slice(0,5),K=()=>{const t=r=>`"${String(r).replace(/"/g,'""')}"`,s=[["Txn ID","Operator Name","CA Number","Amount","Commission","TDS","Status","Refunded","Date Added"],...l.map(r=>[t(r.txnid||""),t(r.operatorname||""),t(r.canumber||""),r.amount||0,r.comm||0,r.tds||0,t(r.status||""),r.refunded||0,t(new Date(r.created_at).toLocaleDateString())])].map(r=>r.join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),i=window.URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download="municipality_transactions.csv",o.click(),window.URL.revokeObjectURL(i)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Municipality Dashboard"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("select",{value:L,onChange:t=>G(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Select time filter",children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",value:b,onChange:t=>R(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Start date"}),e.jsx("input",{type:"date",value:f,onChange:t=>T(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"End date"}),e.jsxs("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-indigo-300 transition-colors duration-200",onClick:V,disabled:!b||!f,"aria-label":"Apply date filter",children:[e.jsx(me,{className:"h-4 w-4 inline mr-1"})," Apply"]}),e.jsx("button",{onClick:K,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200","aria-label":"Export data as CSV",children:"Export Data"})]})]}),H?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(xe,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:j}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(v,{className:"h-5 w-5 text-green-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",C.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["vs. yesterday (₹",w.toLocaleString(),")"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(v,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg. Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",parseFloat(z).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(se,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${parseFloat(y)<50?"text-white bg-red-500":"text-white bg-green-500"}`,children:[parseFloat(y)<50?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),y,"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[y,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(v,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Commission"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",I.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(v,{className:"h-5 w-5 text-red-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${n<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[n<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),n.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total TDS"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",X.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Amount Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:Q,options:F,"aria-label":"Amount Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Success Rate by Period"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:Z,options:F,"aria-label":"Success Rate by Period Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Commission Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(A,{data:q,options:F,"aria-label":"Commission Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Top Operators by Amount"}),e.jsx("a",{href:"#",className:"text-sm text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"View More"})]}),e.jsx("div",{className:"space-y-4",children:$.length>0?$.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 mr-3",children:e.jsx("span",{className:"font-medium",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comm: ₹",t.comm.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:["₹",t.amount.toLocaleString()]})]},s)):e.jsx("p",{className:"text-sm text-gray-500",children:"No operators available."})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Recent Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-gray-600 font-medium",children:[e.jsx("th",{className:"p-3 border-b",children:"Txn ID"}),e.jsx("th",{className:"p-3 border-b",children:"Operator Name"}),e.jsx("th",{className:"p-3 border-b",children:"CA Number"}),e.jsx("th",{className:"p-3 border-b",children:"Amount (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Commission (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"TDS (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Status"}),e.jsx("th",{className:"p-3 border-b",children:"Refunded (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Date Added"})]})}),e.jsx("tbody",{children:l.length>0?l.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b",children:t.txnid||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.operatorname||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.canumber||"N/A"}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.amount||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.comm||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.tds||0).toLocaleString()]}),e.jsx("td",{className:"p-3 border-b",children:t.status||"N/A"}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.refunded||0).toLocaleString()]}),e.jsx("td",{className:"p-3 border-b",children:new Date(t.created_at).toLocaleDateString()})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-3 text-center text-gray-500",children:"No transactions found for this period."})})})]})})]})]})]})})};export{je as default};
