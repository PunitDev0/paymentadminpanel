import{r as g,s as se,j as e}from"./app-B7MyKtmx.js";import{P as ae,L,C as re,a as ne,b as oe,c as le,d as de,p as ie,e as ce,f as me}from"./index-p-0GKzDs.js";import{F as xe,D as y}from"./filter-f6KcnIlz.js";import{F as he}from"./file-text-e-fJ0s_i.js";import{A as u,a as p}from"./arrow-up-YBHVgQjp.js";re.register(ne,oe,le,de,ie,ce,me);const ye=()=>{const[D,P]=g.useState([]),[l,W]=g.useState([]),[A,U]=g.useState("Daily"),[b,_]=g.useState(""),[f,R]=g.useState(""),[H,T]=g.useState(!1);g.useEffect(()=>{Y()},[]);const Y=async()=>{T(!0);try{const t=await se();console.log("Fetched Bill Payment Data:",t);const s=t.map(a=>({...a,date_added:new Date(a.date_added)}));P(s),S(s,A,b,f)}catch(t){console.error("Failed to fetch bill payment data:",t)}finally{T(!1)}},S=(t,s,a,d)=>{let n=[...t];const r=new Date;if(a&&d){const x=new Date(a),m=new Date(d);m.setHours(23,59,59,999),n=n.filter(i=>{const h=new Date(i.date_added);return h>=x&&h<=m}),console.log("Date Range Filter Applied:",{startDate:x,endDate:m,filtered:n})}else{switch(s){case"Daily":n=n.filter(i=>{const h=new Date(i.date_added);return h.getDate()===r.getDate()&&h.getMonth()===r.getMonth()&&h.getFullYear()===r.getFullYear()});break;case"Weekly":const x=new Date(r);x.setDate(r.getDate()-7),n=n.filter(i=>new Date(i.date_added)>=x);break;case"Monthly":const m=new Date(r);m.setMonth(r.getMonth()-1),n=n.filter(i=>new Date(i.date_added)>=m);break}console.log(`${s} Filter Applied:`,n)}n.length===0&&(n=[...t]),W(n)},G=t=>{U(t),_(""),R(""),S(D,t,"","")},I=()=>{b&&f&&S(D,"",b,f)},j=l.length,C=l.reduce((t,s)=>t+parseFloat(s.amount||0),0),V=j?(C/j).toFixed(2):0,N=j>0?(l.filter(t=>t.transaction_status.toLowerCase()==="success").length/j*100).toFixed(2):0,z=l.reduce((t,s)=>t+parseFloat(s.commission||0),0),X=l.reduce((t,s)=>t+parseFloat(s.tds||0),0),Q=l.reduce((t,s)=>t+parseFloat(s.refunded||0),0),k=new Date,w=new Date(k);w.setDate(k.getDate()-1);const v=D.filter(t=>{const s=new Date(t.date_added);return s.getDate()===w.getDate()&&s.getMonth()===w.getMonth()&&s.getFullYear()===w.getFullYear()}).reduce((t,s)=>t+parseFloat(s.amount||0),0),o=v?(C-v)/v*100:0,c=[...new Set(l.map(t=>new Date(t.date_added).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})))].sort((t,s)=>new Date(t.split("/").reverse().join("-"))-new Date(s.split("/").reverse().join("-"))),B=c.map(t=>l.filter(s=>new Date(s.date_added).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((s,a)=>s+parseFloat(a.amount||0),0)),$=c.map(t=>{const s=l.filter(d=>new Date(d.date_added).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((d,n)=>d+(n.transaction_status.toLowerCase()==="success"?1:0),0),a=l.filter(d=>new Date(d.date_added).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).length;return a>0?s/a*100:0}),E=c.map(t=>l.filter(s=>new Date(s.date_added).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})===t).reduce((s,a)=>s+parseFloat(a.commission||0),0));console.log("Chart Data:",{dates:c,amountTrend:B,successRateTrend:$,commissionTrend:E});const Z={labels:c,datasets:[{label:"Amount",data:B,borderColor:"#6366f1",backgroundColor:"#6366f1",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#6366f1",pointBorderWidth:2,tension:.4}]},q={labels:c,datasets:[{label:"Success Rate (%)",data:$,borderColor:"#10b981",backgroundColor:"#10b981",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#10b981",pointBorderWidth:2,tension:.4}]},J={labels:c,datasets:[{label:"Commission",data:E,borderColor:"#f59e0b",backgroundColor:"#f59e0b",borderWidth:3,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:"#fff",pointBorderColor:"#f59e0b",pointBorderWidth:2,tension:.4}]},F={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:12},color:"#6b7280"}},tooltip:{enabled:!1,external:t=>{let s=document.getElementById("chartjs-tooltip");s||(s=document.createElement("div"),s.id="chartjs-tooltip",s.className="bg-white p-3 rounded-lg shadow-lg border border-gray-200",document.body.appendChild(s));const a=t.tooltip;if(a.opacity===0){s.style.opacity="0";return}if(s.style.opacity="1",s.style.position="absolute",s.style.pointerEvents="none",a.body){const n=a.title||[],r=a.body.map(m=>m.lines);let x=`<div class="text-sm text-gray-800 font-medium">${n[0]}</div>`;r.forEach((m,i)=>{const h=a.labelColors[i].borderColor,O=m[0].split(": ")[1],te=a.dataPoints[i].dataset.label.includes("Success Rate")?`${parseFloat(O).toFixed(2)}%`:`₹${parseFloat(O).toLocaleString()}`;x+=`
                <div class="text-sm text-gray-600 flex items-center">
                  <span class="w-3 h-3 rounded-full mr-2" style="background-color: ${h}"></span>
                  ${a.dataPoints[i].dataset.label}: ${te}
                </div>`}),s.innerHTML=x}const d=t.chart.canvas.getBoundingClientRect();s.style.left=d.left+window.pageXOffset+a.caretX+"px",s.style.top=d.top+window.pageYOffset+a.caretY+"px"}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12}}},y:{grid:{color:"#e5e7eb"},ticks:{color:"#6b7280",font:{size:12},callback:t=>{const s=context.chart;return s?s.data.datasets[0].label.includes("Success Rate")?`${t}%`:`₹${t.toLocaleString()}`:t}},beginAtZero:!0,max:t=>t.chart&&t.chart.data.datasets[0].label.includes("Success Rate")?100:void 0}},animation:{duration:800,easing:"easeOutQuart"}},K=l.reduce((t,s)=>{const a=s.operator_name||"Unknown";return t[a]||(t[a]={amount:0,commission:0}),t[a].amount+=parseFloat(s.amount||0),t[a].commission+=parseFloat(s.commission||0),t},{}),M=Object.entries(K).map(([t,{amount:s,commission:a}])=>({name:t,amount:s,commission:a})).sort((t,s)=>s.amount-t.amount).slice(0,5),ee=()=>{const t=r=>`"${String(r).replace(/"/g,'""')}"`,s=[["Reference ID","Transaction ID","Operator Name","Customer Number","Amount","Commission","TDS","Refunded","Transaction Status","Date Added"],...l.map(r=>[t(r.reference_id||""),t(r.transaction_id||""),t(r.operator_name||""),t(r.customer_number||""),r.amount||0,r.commission||0,r.tds||0,r.refunded||0,t(r.transaction_status||""),t(new Date(r.date_added).toLocaleDateString())])].map(r=>r.join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),d=window.URL.createObjectURL(a),n=document.createElement("a");n.href=d,n.download="bill_payment_transactions.csv",n.click(),window.URL.revokeObjectURL(d)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Bill Payment Dashboard"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("select",{value:A,onChange:t=>G(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Select time filter",children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",value:b,onChange:t=>_(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Start date"}),e.jsx("input",{type:"date",value:f,onChange:t=>R(t.target.value),className:"p-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"End date"}),e.jsxs("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-indigo-300 transition-colors duration-200",onClick:I,disabled:!b||!f,"aria-label":"Apply date filter",children:[e.jsx(xe,{className:"h-4 w-4 inline mr-1"})," Apply"]}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200","aria-label":"Export data as CSV",children:"Export Data"})]})]}),H?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(he,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:j}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(y,{className:"h-5 w-5 text-green-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",C.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["vs. yesterday (₹",v.toLocaleString(),")"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(y,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg. Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",parseFloat(V).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(ae,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${parseFloat(N)<50?"text-white bg-red-500":"text-white bg-green-500"}`,children:[parseFloat(N)<50?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),N,"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[N,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(y,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Commission"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",z.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(y,{className:"h-5 w-5 text-red-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total TDS"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",X.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:e.jsx(y,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full flex items-center ${o<0?"text-white bg-red-500":"text-white bg-green-500"}`,children:[o<0?e.jsx(u,{className:"h-3 w-3 mr-1"}):e.jsx(p,{className:"h-3 w-3 mr-1"}),o.toFixed(2),"%"]})]}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Refunded"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["₹",Q.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"vs. yesterday"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Amount Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(L,{data:Z,options:F,"aria-label":"Amount Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Success Rate by Period"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(L,{data:q,options:F,"aria-label":"Success Rate by Period Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Commission Trend"}),e.jsx("div",{className:"h-64",children:c.length>0?e.jsx(L,{data:J,options:F,"aria-label":"Commission Trend Chart"}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No data available"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Top Operators by Amount"}),e.jsx("a",{href:"#",className:"text-sm text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"View More"})]}),e.jsx("div",{className:"space-y-4",children:M.length>0?M.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 mr-3",children:e.jsx("span",{className:"font-medium",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comm: ₹",t.commission.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:["₹",t.amount.toLocaleString()]})]},s)):e.jsx("p",{className:"text-sm text-gray-500",children:"No operators available."})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Recent Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-gray-600 font-medium",children:[e.jsx("th",{className:"p-3 border-b",children:"Reference ID"}),e.jsx("th",{className:"p-3 border-b",children:"Transaction ID"}),e.jsx("th",{className:"p-3 border-b",children:"Operator Name"}),e.jsx("th",{className:"p-3 border-b",children:"Customer Number"}),e.jsx("th",{className:"p-3 border-b",children:"Amount (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Commission (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"TDS (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Refunded (₹)"}),e.jsx("th",{className:"p-3 border-b",children:"Transaction Status"}),e.jsx("th",{className:"p-3 border-b",children:"Date Added"})]})}),e.jsx("tbody",{children:l.length>0?l.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b",children:t.reference_id||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.transaction_id||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.operator_name||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:t.customer_number||"N/A"}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.amount||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.commission||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.tds||0).toLocaleString()]}),e.jsxs("td",{className:"p-3 border-b",children:["₹",parseFloat(t.refunded||0).toLocaleString()]}),e.jsx("td",{className:"p-3 border-b",children:t.transaction_status||"N/A"}),e.jsx("td",{className:"p-3 border-b",children:new Date(t.date_added).toLocaleDateString()})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"p-3 text-center text-gray-500",children:"No transactions found for this period."})})})]})})]})]})]})})};export{ye as default};
