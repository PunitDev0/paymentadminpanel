import{w as H,r as n,j as e,M as y,x as I,Q as J,R as K,T as W,V as X}from"./app-CyB6Si8G.js";import{M as D}from"./map-pin-Bs1gd1FZ.js";/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Z=H("Pencil",Y);function te(){const[j,g]=n.useState([]),[x,F]=n.useState([]),[A,k]=n.useState(!1),[o,b]=n.useState(null),[L,M]=n.useState(null),[S,P]=n.useState({fields:[{key:"name",value:"",type:"text",placeholder:"Enter Name"},{key:"display_name",value:"",type:"text",placeholder:"Enter Display Name"}]}),[f,N]=n.useState(null),[p,c]=n.useState([]),[C,v]=n.useState(""),[m,u]=n.useState(!1),[h,i]=n.useState(null);n.useEffect(()=>{async function s(){u(!0);try{const[t,a]=await Promise.all([y(),I()]);g(t),F(a)}catch(t){console.error("Error fetching data:",t),i("Failed to load data")}finally{u(!1)}}s()},[]);const O=(s,t)=>{const{value:a}=t.target,l=[...S.fields];l[s].value=a,console.log(`Updating field ${l[s].key} to:`,a),P(r=>({...r,fields:l}))},$=s=>{console.log("Editing role:",s),b({...s}),M({...s})},z=s=>{const{name:t,value:a}=s.target;console.log(`Changing ${t} to:`,a),b(l=>({...l,[t]:a}))},V=async s=>{if(confirm(`Are you sure you want to delete role "${s.display_name}"?`))try{u(!0),await J(s.id),alert("Role deleted successfully");const t=await y();g(t)}catch(t){console.error("Error deleting role:",t),alert("Failed to delete role")}finally{u(!1)}},R=async s=>{s.preventDefault(),u(!0),i(null);try{if(o!=null&&o.id){const t={};if(Object.keys(o).forEach(l=>{o[l]!==L[l]&&(t[l]=o[l])}),console.log("Updated Fields for Edit:",t),Object.keys(t).length===0){alert("No changes made."),b(null);return}const a=await K(o.id,t);if(a.message==="Role updated successfully"){alert("Role updated successfully");const l=await y();g(l),b(null)}else i(a.message||"Update failed")}else{const t=S.fields.reduce((l,r)=>(l[r.key]=r.value,l),{});if(console.log("Form Values for Add:",t),!t.name||!t.display_name)throw new Error("All fields (name, display_name) are required");const a=await W(t);if(a.message==="Role added successfully"){alert("New role added successfully");const l=await y();g(l),P({fields:[{key:"name",value:"",type:"text",placeholder:"Enter Name"},{key:"display_name",value:"",type:"text",placeholder:"Enter Display Name"}]}),k(!1)}else i(a.message||"Failed to add role")}}catch(t){if(console.error("Error submitting role:",t),t.response&&t.response.status===422){const a=t.response.data.errors||{},l=Object.values(a).flat().join(", ")||"Validation errors";i(l)}else i(t.message||"Failed to submit role")}finally{u(!1)}},E=s=>{const t=j.find(a=>a.id===s);return console.log("Role Data:",t),!t||!t.permissions?(console.warn("No permissions found for role:",s),[]):t.permissions.map(a=>a.id)},q=s=>{c(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},U=[...new Set(x.map(s=>s.type))],T=x.filter(s=>s.type.toLowerCase().includes(C.toLowerCase())),G=()=>{const s=x.map(t=>t.id);c(t=>t.length===s.length?[]:s)},B=async()=>{if(f){u(!0),i(null);try{const s=E(f.id);console.log("Current Assigned Permissions:",s),console.log("Selected Permissions:",p);const t=p.length>0?p:s,a=x.filter(r=>t.includes(r.id)).map(r=>r.id),l=await X(f.id,a);if(l.message==="Role permissions updated successfully"){alert("Role permissions updated successfully"),N(null),c([]),v("");const r=await y();g(r)}else i(l.message||"Failed to update permissions")}catch(s){if(console.error("Error updating role permissions:",s),s.response&&s.response.status===422){const t=s.response.data.errors||{},a=Object.values(t).flat().join(", ")||"Validation errors";i(a)}else i(s.message||"Failed to update permissions")}finally{u(!1)}}};return e.jsxs("div",{className:"max-w-full bg-gray-100 mt-2 w-full",children:[e.jsxs("div",{className:"bg-gray-700 flex justify-between p-2 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-white font-bold text-xl",children:"Roles"}),e.jsx("button",{className:"px-2 py-1 bg-primary_color text-white font-semibold rounded hover:bg-secondary_color hover:scale-105 transition duration-300",onClick:()=>k(!0),children:"Add New+"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-400 shadow-md rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gradient-to-r from-green-900 via-green-500 to-pink-300 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"ID"}),e.jsx("th",{className:"border p-2",children:"Name"}),e.jsx("th",{className:"border p-2",children:"Display Name"}),e.jsx("th",{className:"border p-2",children:"Last Updated Date"}),e.jsx("th",{className:"border p-2",children:"Action"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-4",children:"Loading..."})}):j.length>0?j.map(s=>e.jsxs("tr",{className:"border text-center",children:[e.jsx("td",{className:"p-2 border",children:s.id}),e.jsx("td",{className:"p-2 border",children:s.name}),e.jsx("td",{className:"p-2 border",children:s.display_name}),e.jsx("td",{className:"p-2 border",children:s.updated_at?new Date(s.updated_at).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,year:"numeric",month:"2-digit",day:"2-digit"}):"Not updated yet"}),e.jsxs("td",{className:"p-2 border",children:[e.jsx("button",{className:"bg-red-800 text-white px-1 py-1 rounded mr-2 hover:bg-red-900 transition duration-300",onClick:()=>V(s),children:"Delete"}),e.jsx("button",{className:"bg-yellow-500 text-white px-1 py-1 rounded mr-2 hover:bg-yellow-600 transition duration-300",onClick:()=>$(s),children:"Edit"}),e.jsx("button",{className:"bg-blue-500 text-white px-1 py-1 rounded hover:bg-blue-600 transition duration-300",onClick:()=>{N(s);const t=E(s.id);console.log("Assigned Permissions on Open:",t),j.length>0&&t.length===0&&s.permissions?(console.warn("Fallback to row.permissions:",s.permissions.map(a=>a.id)),c(s.permissions.map(a=>a.id))):c(t)},children:e.jsx(Z,{size:16})})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-4",children:h||"No data available"})})})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center min-h-screen transition-all ease-in-out duration-300",children:e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-lg w-11/12 md:w-2/3 lg:w-1/2 max-h-[80vh] overflow-y-auto transform scale-100 hover:scale-105 transition-all ease-in-out duration-300",children:e.jsxs("form",{onSubmit:R,children:[S.fields.map((s,t)=>e.jsxs("div",{className:"mb-2 relative group",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:s.placeholder}),e.jsx("span",{className:"absolute left-2 transition-transform duration-300 ease-in-out group-hover:scale-125",children:e.jsx(D,{size:20,className:"text-blue-500 animate-bounce"})}),e.jsx("input",{type:s.type,name:s.key,placeholder:s.placeholder,value:s.value,onChange:a=>O(t,a),className:"w-full border p-2 pl-8 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-600",required:!0})]},s.key)),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"submit",className:"bg-primary_color text-black p-1 rounded font-bold hover:bg-secondary_color hover:scale-105 transition duration-300",disabled:m,children:m?"Submitting...":"Submit"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 p-1 rounded hover:bg-gray-400 transition duration-300",onClick:()=>k(!1),children:"Close"})]}),h&&e.jsx("p",{className:"text-red-600 text-center mt-2",children:h})]})})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center min-h-screen transition-all ease-in-out duration-300",children:e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-lg w-11/12 md:w-2/3 lg:w-1/2 max-h-[80vh] overflow-y-auto transform scale-100 hover:scale-105 transition-all ease-in-out duration-300",children:e.jsxs("form",{onSubmit:R,children:[[{key:"name",label:"Name",value:o.name||""},{key:"display_name",label:"Display Name",value:o.display_name||""}].map(s=>e.jsxs("div",{className:"mb-2 relative group",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:s.label}),e.jsx("span",{className:"absolute left-2 transition-transform duration-300 ease-in-out group-hover:scale-125",children:e.jsx(D,{size:20,className:"text-blue-500 animate-bounce"})}),e.jsx("input",{type:"text",name:s.key,value:s.value,onChange:z,className:"w-full border p-2 pl-8 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-600",required:!0})]},s.key)),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"submit",className:"bg-primary_color text-white p-1 rounded font-bold hover:bg-secondary_color hover:scale-105 transition duration-300",disabled:m,children:m?"Submitting...":"Submit"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 p-1 rounded hover:bg-gray-400 transition duration-300",onClick:()=>b(null),children:"Close"})]}),h&&e.jsx("p",{className:"text-red-600 text-center mt-2",children:h})]})})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center min-h-screen transition-all ease-in-out duration-300",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-[80vh] overflow-y-auto transform scale-100 hover:scale-105 transition-all ease-in-out duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Member Permission - ",f.display_name]}),e.jsx("button",{onClick:()=>{N(null),c([]),v("")},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Filter by Permission Type"}),e.jsx("input",{type:"text",value:C,onChange:s=>v(s.target.value),className:"w-full border p-2 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-600",placeholder:"Enter type (e.g., Admin Activity, Member)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Permissions"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.length===x.length,onChange:G,className:"mr-2"}),"Select All"]})]}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border p-2 text-left w-1/4",children:"Section Category"}),e.jsx("th",{className:"border p-2 text-left",children:"Permissions"})]})}),e.jsx("tbody",{children:U.map(s=>{const t=T.filter(l=>l.type===s);if(t.length===0)return null;const a=[];for(let l=0;l<t.length;l+=3)a.push(t.slice(l,l+3));return a.map((l,r)=>e.jsxs("tr",{className:"border",children:[r===0?e.jsx("td",{className:"border p-2 align-top w-1/4",rowSpan:a.length,children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.every(d=>p.includes(d.id)),onChange:d=>{const _=t.map(w=>w.id);c(w=>d.target.checked?[...new Set([...w,..._])]:w.filter(Q=>!_.includes(Q)))},className:"mr-2"}),s]})}):null,e.jsx("td",{className:"border p-2",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:l.map(d=>e.jsxs("label",{className:"flex items-center w-1/3",children:[e.jsx("input",{type:"checkbox",id:`perm-${d.id}`,value:d.id,checked:p.includes(d.id),onChange:()=>q(d.id),className:"mr-2"}),d.display_name]},d.id))})})]},`${s}-${r}`))})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"bg-primary_color text-black p-1 rounded font-bold hover:bg-secondary_color hover:scale-105 transition duration-300",onClick:B,disabled:m,children:m?"Saving...":"Save Permissions"}),e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-700 p-1 rounded hover:bg-gray-400 transition duration-300",onClick:()=>{N(null),c([]),v("")},children:"Close"})]}),h&&e.jsx("p",{className:"text-red-600 text-center mt-2",children:h})]})})]})}export{te as default};
