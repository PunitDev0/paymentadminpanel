import{a as y,r as p,j as e}from"./app-D8zORXH6.js";const w="http://127.0.0.1:8000",C=[{id:"all",title:"All Commissions"},{id:"recharge",title:"Recharge"},{id:"electricity",title:"Electricity"},{id:"digital_voucher",title:"Digital Voucher"},{id:"datacard",title:"Datacard"},{id:"gas_fastag",title:"Gas & Fastag"},{id:"cms",title:"CMS"},{id:"challan",title:"Challan"},{id:"cable",title:"Cable"},{id:"broadband",title:"Broadband"},{id:"bank",title:"Bank"}],A=async()=>{try{return(await y.get(`${w}/data`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch{throw new Error("Failed to fetch default commissions")}},V=async d=>{try{return(await y.get(`${w}/users/${d}/data`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch{throw new Error("Failed to fetch user commissions")}},Q=async()=>{try{return(await y.get(`${w}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch{throw new Error("Failed to fetch users")}},E=async(d,x)=>{try{return(await y.put(`${w}/${d}`,x,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch{throw new Error(`Failed to update default commissions for ${d}`)}},L=async(d,x)=>{try{return(await y.put(`${w}/users/${d}`,x,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch{throw new Error("Failed to update user commissions")}},G=()=>{const[d,x]=p.useState({recharge_commissions:[],electricity_commissions:[],digital_voucher_commissions:[],datacard_commissions:[],gas_fastag_commissions:[],cms_commissions:[],challan_commissions:[],cable_commissions:[],broadband_commissions:[],bank_commissions:[]}),[g,_]=p.useState({}),[h,f]=p.useState({}),[N,B]=p.useState("all"),[o,O]=p.useState(null),[v,k]=p.useState([]),[S,z]=p.useState({recharge_commissions:"",electricity_commissions:"",digital_voucher_commissions:"",datacard_commissions:"",gas_fastag_commissions:"",cms_commissions:"",challan_commissions:"",cable_commissions:"",broadband_commissions:"",bank_commissions:""});p.useEffect(()=>{(async()=>{try{const r=await A();x(r);const t=await Q();k(t)}catch(r){console.error("Failed to fetch initial data:",r),x({recharge_commissions:[],electricity_commissions:[],digital_voucher_commissions:[],datacard_commissions:[],gas_fastag_commissions:[],cms_commissions:[],challan_commissions:[],cable_commissions:[],broadband_commissions:[],bank_commissions:[]}),k([])}})()},[]),p.useEffect(()=>{(async()=>{if(o)try{const r=await V(o.id);x(r.default_commissions);const t={};r.user_commissions.forEach(i=>{t[`${i.commission_type}_${i.commission_id}`]=i.user_commission}),_(t)}catch(r){console.error("Failed to fetch user commissions:",r),_({})}else _({}),A().then(x).catch(console.error)})()},[o]);const b=(a,r,t)=>{const i=r===""?0:parseFloat(r)||0,m=t.replace("_commissions","");o?(_(c=>({...c,[`${m}_${a}`]:i})),f(c=>{const s={...c};s.userCommissions||(s.userCommissions=[]);const n=s.userCommissions.findIndex(l=>l.commission_type===m&&l.commission_id===a);return n!==-1?s.userCommissions[n]={commission_type:m,commission_id:a,user_commission:i}:s.userCommissions.push({commission_type:m,commission_id:a,user_commission:i}),s})):f(c=>{const s={...c};s[t]||(s[t]=[]);const n=s[t].findIndex(l=>l.id===a);return n!==-1?s[t][n]={id:a,our_commission:i}:s[t].push({id:a,our_commission:i}),s})},I=async()=>{if(Object.keys(h).length===0){alert("No changes to save.");return}try{if(o&&h.userCommissions)await L(o.id,h.userCommissions),alert("User commissions updated successfully!");else{const a=Object.keys(h).map(r=>E(r.replace("_commissions",""),h[r]));await Promise.all(a),alert("Default commissions updated successfully!")}f({})}catch(a){alert("Failed to update commissions: "+a.message)}},j=async(a,r)=>{var i,m;const t=r.replace("_commissions","");if(o){const c=(i=h.userCommissions)==null?void 0:i.find(s=>s.commission_type===t&&s.commission_id===a);if(!c){alert("No changes to save for this row.");return}try{await L(o.id,[c]),f(s=>{var n;return{...s,userCommissions:((n=s.userCommissions)==null?void 0:n.filter(l=>!(l.commission_type===t&&l.commission_id===a)))||[]}}),alert("User commission updated successfully!")}catch(s){alert("Failed to update user commission: "+s.message)}}else{const c=(m=h[r])==null?void 0:m.find(s=>s.id===a);if(!c){alert("No changes to save for this row.");return}try{await E(t,[c]),f(s=>{const n={...s};return n[r]=n[r].filter(l=>l.id!==a),n[r].length===0&&delete n[r],n}),alert("Default commission updated successfully!")}catch(s){alert("Failed to update default commission: "+s.message)}}},R=(a,r)=>{z(t=>({...t,[a]:r}))},K=(a,r)=>{const t=S[r].toLowerCase();return t?a.filter(i=>{var m,c,s,n,l,u,D,F,$,U;return r==="bank_commissions"?((m=i.transaction_amount)==null?void 0:m.toString().toLowerCase().includes(t))||((c=i.category)==null?void 0:c.toLowerCase().includes(t)):r==="cms_commissions"?((s=i.operator_id)==null?void 0:s.toLowerCase().includes(t))||((n=i.operator_name)==null?void 0:n.toLowerCase().includes(t))||((l=i.type)==null?void 0:l.toLowerCase().includes(t)):["gas_fastag_commissions","broadband_commissions"].includes(r)?((u=i.operator_name)==null?void 0:u.toLowerCase().includes(t))||((D=i.category)==null?void 0:D.toLowerCase().includes(t))||((F=i.type)==null?void 0:F.toLowerCase().includes(t)):(($=i.operator_name)==null?void 0:$.toLowerCase().includes(t))||((U=i.type)==null?void 0:U.toLowerCase().includes(t))}):a},M=()=>{var r;const a=N==="all"?Object.keys(d):[((r=C.find(t=>t.id===N))==null?void 0:r.id)+"_commissions"];return e.jsxs("div",{className:"mt-6 space-y-8",children:[o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"User Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",o.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",o.email]})]}),a.map(t=>{const i=d[t]||[],m=K(i,t);if(!m.length)return null;const c=C.find(s=>s.id+"_commissions"===t);return c?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:[c.title," Commissions"]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:`Search ${c.title}...`,value:S[t],onChange:s=>R(t,s.target.value),className:"w-full sm:w-64 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[["recharge_commissions","electricity_commissions","digital_voucher_commissions","datacard_commissions","challan_commissions","cable_commissions"].includes(t)&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operator Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Default Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:o?"User Commission":"Set Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]}),["gas_fastag_commissions","broadband_commissions"].includes(t)&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operator Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Default Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:o?"User Commission":"Set Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]}),t==="cms_commissions"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agent ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agent Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Default Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:o?"User Commission":"Set Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]}),t==="bank_commissions"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transaction Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Default Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:o?"User Commission":"Set Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(s=>{const n=t.replace("_commissions",""),l=o?g[`${n}_${s.id}`]??s.commission:s.commission;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[["recharge_commissions","electricity_commissions","digital_voucher_commissions","datacard_commissions","challan_commissions","cable_commissions"].includes(t)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.operator_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.commission}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:l,onChange:u=>b(s.id,u.target.value,t),className:"border rounded-lg p-2 w-20 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>j(s.id,t),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save"})})]}),["gas_fastag_commissions","broadband_commissions"].includes(t)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.operator_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.commission}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:l,onChange:u=>b(s.id,u.target.value,t),className:"border rounded-lg p-2 w-20 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>j(s.id,t),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save"})})]}),t==="cms_commissions"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.operator_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.operator_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.commission}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:l,onChange:u=>b(s.id,u.target.value,t),className:"border rounded-lg p-2 w-20 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>j(s.id,t),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save"})})]}),t==="bank_commissions"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.transaction_amount}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.commission}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:l,onChange:u=>b(s.id,u.target.value,t),className:"border rounded-lg p-2 w-20 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>j(s.id,t),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save"})})]})]},s.id)})})]})})]},t):null}),a.length>0&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:I,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md",children:"Save All Changes"})})]})};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Commission Manager"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Commission Type"}),e.jsx("select",{value:N,onChange:a=>B(a.target.value),className:"w-full sm:w-64 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:C.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User (Optional)"}),e.jsxs("select",{value:o?o.id:"",onChange:a=>{const r=a.target.value;O(v.find(t=>t.id===parseInt(r))||null)},className:"w-full sm:w-64 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Default (All Users)"}),v.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.email,")"]},a.id))]})]})]}),M()]})})};export{G as default,A as getCommissions,V as getUserCommissions,Q as getUsers,E as updateCommissions,L as updateUserCommissions};
