import{r,j as t}from"./app-CVSLwbXb.js";import{q as H}from"./apis-BrEZBuSk.js";import{L as j,C as J,a as K,b as Q,P as V,c as X,p as Z,d as $,e as ee}from"./index-BIsqsAbn.js";J.register(K,Q,V,X,Z,$,ee);const ne=()=>{const[f,F]=r.useState([]),[o,C]=r.useState([]),[D,_]=r.useState("Daily"),[h,w]=r.useState(""),[x,N]=r.useState(""),[S,y]=r.useState(!1);r.useEffect(()=>{T()},[]);const T=async()=>{y(!0);try{const e=await H();console.log("Fetched Bill Payment Data:",e),F(e),b(e,D,h,x)}catch(e){console.error("Failed to fetch bill payment data:",e)}finally{y(!1)}},b=(e,a,n,i)=>{let s=[...e];const l=new Date;if(n&&i){const p=new Date(n),g=new Date(i);s=s.filter(d=>{const m=new Date(d.date_added);return m>=p&&m<=g})}else switch(a){case"Daily":s=s.filter(d=>{const m=new Date(d.date_added);return m.getDate()===l.getDate()&&m.getMonth()===l.getMonth()&&m.getFullYear()===l.getFullYear()});break;case"Weekly":const p=new Date(l);p.setDate(l.getDate()-7),s=s.filter(d=>new Date(d.date_added)>=p);break;case"Monthly":const g=new Date(l);g.setMonth(l.getMonth()-1),s=s.filter(d=>new Date(d.date_added)>=g);break}s.length===0&&(s=[...e]),console.log("Filtered Bill Payment Data:",s),C(s)},L=e=>{_(e),w(""),N(""),b(f,e,"","")},A=()=>{h&&x&&b(f,"",h,x)},u=o.length,v=o.reduce((e,a)=>e+parseFloat(a.amount||0),0),R=u?(v/u).toFixed(2):0,k=u>0?(o.filter(e=>e.transaction_status.toLowerCase()==="success").length/u*100).toFixed(2):0,E=o.reduce((e,a)=>e+parseFloat(a.commission||0),0),M=o.reduce((e,a)=>e+parseFloat(a.tds||0),0),P=o.reduce((e,a)=>e+parseFloat(a.refunded||0),0),c=[...new Set(o.map(e=>new Date(e.date_added).toLocaleDateString()))].sort(),B=c.map(e=>o.filter(a=>new Date(a.date_added).toLocaleDateString()===e).reduce((a,n)=>a+parseFloat(n.amount||0),0)),O=c.map(e=>o.filter(a=>new Date(a.date_added).toLocaleDateString()===e).reduce((a,n)=>a+(n.transaction_status.toLowerCase()==="success"?1:0),0)),U=c.map(e=>o.filter(a=>new Date(a.date_added).toLocaleDateString()===e).reduce((a,n)=>a+parseFloat(n.commission||0),0)),W={labels:c,datasets:[{label:"Amount",data:B,borderColor:"green",fill:!1}]},I={labels:c,datasets:[{label:"Success Rate (%)",data:O,borderColor:"green",fill:!1}]},Y={labels:c,datasets:[{label:"Commission",data:U,borderColor:"orange",fill:!1}]},q=o.reduce((e,a)=>{const n=a.operator_name;return e[n]||(e[n]={amount:0,commission:0}),e[n].amount+=parseFloat(a.amount||0),e[n].commission+=parseFloat(a.commission||0),e},{}),z=Object.entries(q).map(([e,{amount:a,commission:n}])=>({name:e,amount:a,commission:n})).sort((e,a)=>a.amount-e.amount).slice(0,5),G=()=>{const e=[["Reference ID","Transaction ID","Operator Name","Customer Number","Amount","Commission","TDS","Refunded","Transaction Status","Date Added"],...o.map(s=>[s.reference_id,s.transaction_id,s.operator_name,s.customer_number,s.amount,s.commission,s.tds,s.refunded,s.transaction_status,new Date(s.date_added).toLocaleDateString()])].map(s=>s.join(",")).join(`
`),a=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download="bill_payment_transactions.csv",i.click(),window.URL.revokeObjectURL(n)};return t.jsxs("div",{className:"container mx-auto p-6 bg-gray-100 min-h-screen",children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bill Payment Dashboard"}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("select",{className:"p-2 border rounded",value:D,onChange:e=>L(e.target.value),children:[t.jsx("option",{value:"Daily",children:"Daily"}),t.jsx("option",{value:"Weekly",children:"Weekly"}),t.jsx("option",{value:"Monthly",children:"Monthly"})]}),t.jsx("input",{type:"date",className:"p-2 border rounded",value:h,onChange:e=>w(e.target.value),placeholder:"dd-mm-yyyy"}),t.jsx("input",{type:"date",className:"p-2 border rounded",value:x,onChange:e=>N(e.target.value),placeholder:"dd-mm-yyyy"}),t.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:A,disabled:!h||!x,children:"Apply Date Filter"})]}),t.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:G,children:"Export Data"})]}),S?t.jsx("div",{className:"text-center",children:"Loading..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Transactions"}),t.jsx("p",{className:"text-2xl",children:u})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Amount"}),t.jsxs("p",{className:"text-2xl",children:["₹",v.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Avg. Amount"}),t.jsxs("p",{className:"text-2xl",children:["₹",R]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Success Rate"}),t.jsxs("p",{className:"text-2xl",children:[k,"%"]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Commission"}),t.jsxs("p",{className:"text-2xl",children:["₹",E.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total TDS"}),t.jsxs("p",{className:"text-2xl",children:["₹",M.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Total Refunded"}),t.jsxs("p",{className:"text-2xl",children:["₹",P.toFixed(2)]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Amount Trend"}),t.jsx(j,{data:W})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Success Rate by Period"}),t.jsx(j,{data:I})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Commission Trend"}),t.jsx(j,{data:Y})]})]}),t.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Top Operators by Amount"}),t.jsx("ul",{children:z.map((e,a)=>t.jsxs("li",{className:"py-2 border-b",children:[e.name,": ₹",e.amount.toFixed(2)," (Comm: ₹",e.commission.toFixed(2),")"]},a))})]})]})]})};export{ne as default};
